# Teller App - Manager Briefing

**Project**: Teller - Saudi News App with TikTok-style vertical swipe feed
**Owner**: Mohammad
**Last Updated**: January 2026
**Status**: Active Development

---

## Session Log: Subscription Grand Slam Offer Redesign

### Problem Statement
Mohammad reviewed the subscription page and identified critical issues:
1. Pricing was inconsistent (showed SAR 16 in value stack, SAR 25 on button)
2. Offer was not compelling ("not grand slam, I did not say wow")
3. Free trial was only 7 days (wanted 1 month)
4. Feature descriptions were unclear
5. Value stack numbers were unbelievable (SAR 120 total)
6. Fake social proof ("32,000+ professionals") - dishonest

### Team Deployed
- **Hormozi**: Grand Slam Offer framework, value equation, headline copy
- **Bee**: Visual hierarchy, scannability, typography
- **majnon**: Psychology triggers, FOMO, identity aspiration

---

## Changes Made

### 1. Pricing Fixed (Consistent SAR 16)

**Files Modified**:
- `app/subscription.tsx`
- `lib/payments/moyasar.ts`

| Item | Before | After |
|------|--------|-------|
| Monthly Price | SAR 25 | **SAR 16** |
| Annual Price | SAR 240 | **SAR 150** |
| Annual Savings | 20% | **22%** |

**Code Changes in `moyasar.ts`**:
```typescript
premium: {
  price: 1600, // halalas (SAR 16)
  priceDisplay: 'SAR 16/month',
  priceDisplayAr: '16 Ø±ÙŠØ§Ù„/Ø´Ù‡Ø±',
}

premium_annual: {
  price: 15000, // halalas (SAR 150)
  priceDisplay: 'SAR 150/year (Save 22%)',
  priceDisplayAr: '150 Ø±ÙŠØ§Ù„/Ø³Ù†Ø© (ÙˆÙØ± 22%)',
}
```

---

### 2. Free Trial Extended to 30 Days

**Before**:
```
"7 Days Free â€¢ No Commitment"
```

**After**:
```
"30 Days Free â€¢ Full Month!"
```

**Arabic**:
```
"30 ÙŠÙˆÙ… Ù…Ø¬Ø§Ù†Ø§Ù‹ â€¢ Ø´Ù‡Ø± ÙƒØ§Ù…Ù„!"
```

---

### 3. Hero Headline Rewritten

**Before** (weak):
```
"Your Time Is Too Valuable"
"Read the top news in 60 seconds instead of an hour"
```

**Rejected Options**:
- "Know Everything. Read Nothing." - Dishonest (they DO read)
- "Never Be the Last to Know" - Good but not Mohammad's vision

**Final (Mohammad's direction)**:
```
EN: "Stay Informed in 5 Minutes"
AR: "ÙƒÙ† Ø¹Ù„Ù‰ Ø§Ø·Ù„Ø§Ø¹ ÙÙŠ Ù¥ Ø¯Ù‚Ø§Ø¦Ù‚"

EN: "All the topics you care about. Every morning."
AR: "ÙƒÙ„ Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹ Ø§Ù„Ù…Ù‡Ù…Ø© Ù„Ùƒ. ÙƒÙ„ ØµØ¨Ø§Ø­."
```

---

### 4. Value Stack Rewritten

**Before** (confusing, unbelievable):
| Feature | Text | Value |
|---------|------|-------|
| Summary | "60-Second Daily Summary" | SAR 50 |
| WhatsApp | "WhatsApp Weekly Digest" | SAR 30 |
| No Ads | "Zero Ads Forever" | SAR 15 |
| AI | "AI Personalized For You" | SAR 25 |
| **Total** | | **SAR 120** |
| Savings | | 79% OFF |

**After** (clear, believable):
| Feature | Text | Value |
|---------|------|-------|
| Summary | "AI Daily News Briefing" | SAR 20 |
| WhatsApp | "Weekly WhatsApp Summary" | SAR 10 |
| No Ads | "Ad-Free Experience" | SAR 10 |
| AI | "News Tailored to Your Interests" | SAR 10 |
| **Total** | | **SAR 50** |
| Savings | | **68% OFF** |

---

### 5. Fake Social Proof Removed

**Before** (lie):
```
"32,000+ professionals get their daily summary"
```

**After** (honest value prop):
```
EN: "Save 1 hour daily from news browsing"
AR: "ÙˆÙÙ‘Ø± Ø³Ø§Ø¹Ø© ÙŠÙˆÙ…ÙŠØ§Ù‹ Ù…Ù† ØªØµÙØ­ Ø§Ù„Ø£Ø®Ø¨Ø§Ø±"
```

---

### 6. Grand Slam Elements Added

#### Money-Back Guarantee
```tsx
<View style={styles.guaranteeBanner}>
  <FontAwesome name="shield" size={16} color={colors.success} />
  <Text>30-Day Money-Back Guarantee - No Questions Asked</Text>
</View>
```

#### Urgency Banner
```tsx
<View style={styles.urgencyBanner}>
  <FontAwesome name="clock-o" size={14} color={colors.warning} />
  <Text>Free month offer for limited time only</Text>
</View>
```

#### CTA Updated
**Before**: "Start 7-Day Free Trial"
**After**: "Start Your Free Month Now"
**Subtext**: "Then SAR 16/month â€¢ Cancel anytime"

---

### 7. New Styles Added

```typescript
guaranteeBanner: {
  flexDirection: 'row',
  alignItems: 'center',
  justifyContent: 'center',
  gap: spacing.sm,
  backgroundColor: 'rgba(52, 199, 89, 0.1)',
  borderWidth: 1,
  borderColor: colors.success,
  borderRadius: borderRadius.md,
  padding: spacing.md,
  marginBottom: spacing.lg,
},

urgencyBanner: {
  flexDirection: 'row',
  alignItems: 'center',
  justifyContent: 'center',
  gap: spacing.xs,
  marginBottom: spacing.md,
},
```

---

## Final Offer Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ğŸ 30 Days Free â€¢ Full Month!           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    âœ¨                           â”‚
â”‚       Stay Informed in 5 Minutes                â”‚
â”‚  All the topics you care about. Every morning. â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Everything You Get:                            â”‚
â”‚  âœ“ AI Daily News Briefing         SAR 20       â”‚
â”‚  âœ“ Weekly WhatsApp Summary        SAR 10       â”‚
â”‚  âœ“ Ad-Free Experience             SAR 10       â”‚
â”‚  âœ“ News Tailored to Your Interests SAR 10     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”‚
â”‚  Total Value:                     SAR 50       â”‚
â”‚  Your Price:        SAR 16/month  [68% OFF]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â±ï¸ Save 1 hour daily from news browsing       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ›¡ï¸ 30-Day Money-Back Guarantee                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     [ Start Your Free Month Now ]              â”‚
â”‚     Then SAR 16/month â€¢ Cancel anytime         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â° Free month offer for limited time only     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Files Modified

| File | Changes |
|------|---------|
| `app/subscription.tsx` | Hero, value stack, pricing, guarantee, urgency, CTA |
| `lib/payments/moyasar.ts` | Price from 2500â†’1600 halalas, annual 24000â†’15000 |

---

## Previous Session: Feed UX Polish (5 Fixes)

Also completed in this session:

1. **Summary button text**: "Summary" â†’ "AI Summary"
2. **Summary button contrast**: Light bg â†’ Dark bg with border
3. **Onboarding back button**: Added X close button
4. **Topic chips**: Made tappable for single-topic filtering
5. **Removed "Teller" text**: Cleaned up header

---

## Principles Followed

- **No lies**: Removed fake "32,000+ professionals" claim
- **Honest pricing**: All numbers consistent and believable
- **Clear copy**: No jargon, users understand immediately
- **Grand Slam elements**: Guarantee, urgency, risk reversal
- **Mohammad's voice**: Used his direction for headline

---

## Next Steps

- Test subscription flow end-to-end
- Verify Moyasar payment processing with new prices
- A/B test headline variations if needed
- Monitor conversion rates after launch

---

*Documented by m7zm - Manager*

---

## Session Log: RSS Sources & Arabic Content Pipeline (2026-01-15)

### Problem Statement
User reported:
1. "Nothing on my feed" - User had seen all 673 stories (753 interactions)
2. "Sources have 0 stories" - `rss_sources` table was EMPTY
3. "I need all the Arabic sources" - Only 3 Arabic sources existed

### Root Causes Identified
1. **Empty feed**: User exhausted all available content (caught up state)
2. **No stories**: `rss_sources` table empty - RSS fetch function reads from this table
3. **Few Arabic sources**: Initial seeding was incomplete

### Solutions Implemented

#### 1. Feed Reset Feature
Added "caught up" state with reset button for users who've seen all stories.

**Files Modified**:
- `lib/api.ts` - Added `resetFeedHistory()` function
- `app/(tabs)/feed.tsx` - Added caught up UI with reset button

**New RLS Policy**:
```sql
CREATE POLICY "Users can delete own interactions" ON user_story_interactions
  FOR DELETE USING (auth.uid() = user_id);
```

#### 2. RSS Sources Seeding
Created comprehensive RSS sources database.

**Migrations Created**:
| Migration | Purpose |
|-----------|---------|
| `20260115000004_add_interactions_delete_policy.sql` | RLS for feed reset |
| `20260115000005_seed_all_rss_sources.sql` | Initial seeding |
| `20260115000006_fix_rss_urls.sql` | Verified working URLs |
| `20260115000007_arabic_sources.sql` | 73 Arabic sources |
| `20260115000008_fix_arabic_rss_urls.sql` | Disable 42 broken Arabic URLs |
| `20260115000009_google_news_arabic_feeds.sql` | Google News workaround |
| `20260115000010_disable_broken_english_sources.sql` | Disable 10 broken English URLs |

#### 3. Google News Workaround
Major Arabic sites block direct RSS. Used Google News RSS as proxy:
```
https://news.google.com/rss/search?q=site:DOMAIN&hl=ar&gl=SA&ceid=SA:ar
```

**Sources Added via Google News**:
- Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Al Arabiya)
- Ø§Ù„Ø¬Ø²ÙŠØ±Ø© (Al Jazeera)
- Ø³ÙƒØ§ÙŠ Ù†ÙŠÙˆØ² Ø¹Ø±Ø¨ÙŠØ© (Sky News Arabia)
- Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø· (Asharq Al-Awsat)
- Ø§Ù„Ø´Ø±Ù‚ (Asharq)
- ÙƒÙˆØ±Ø© (Kooora)
- ÙÙŠÙ„Ø¬ÙˆÙ„ (FilGoal)
- MBC

### Final RSS Sources Status

| Language | Active | Disabled |
|----------|--------|----------|
| Arabic | 39 | 42 |
| English | 26 | 10 |
| **Total** | **65** | 52 |

### Arabic Sources by Category (39 Working)

| Category | Sources |
|----------|---------|
| News | BBC Ø¹Ø±Ø¨ÙŠ, RT Arabic, DW Ø¹Ø±Ø¨ÙŠ, ÙØ±Ø§Ù†Ø³ 24 |
| News (Google) | Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©, Ø§Ù„Ø¬Ø²ÙŠØ±Ø©, Ø³ÙƒØ§ÙŠ Ù†ÙŠÙˆØ², Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø·, Ø§Ù„Ø´Ø±Ù‚ |
| Saudi | Ø³Ø¨Ù‚, Ø¹ÙƒØ§Ø¸, Ø§Ù„ÙˆØ·Ù†, Ø§Ù„ÙŠÙˆÙ…, Ø¹Ø§Ø¬Ù„, Ø£Ø®Ø¨Ø§Ø± 24 |
| Tech | Ø¹Ø§Ù„Ù… Ø§Ù„ØªÙ‚Ù†ÙŠØ©, Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ØªÙ‚Ù†ÙŠØ©, Ø¹Ø±Ø¨ Ù‡Ø§Ø±Ø¯ÙˆÙŠØ±, Ø³Ø¹ÙˆØ¯ÙŠ ØªÙƒ |
| Gaming | Ø³Ø¹ÙˆØ¯ÙŠ Ø¬ÙŠÙ…Ø±, Ø¹Ø±Ø¨ Ø¬ÙŠÙ…Ø±Ø² |
| Sports | ÙŠÙ„Ø§ ÙƒÙˆØ±Ø©, ÙƒÙˆØ±Ø© (Google), ÙÙŠÙ„Ø¬ÙˆÙ„ (Google) |
| Economy | Ø£Ø±Ù‚Ø§Ù…, CNBC Ø¹Ø±Ø¨ÙŠØ©, Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠØ© |
| Entertainment | Ø±ÙˆØªØ§Ù†Ø§, Ù‡ÙŠ, MBC (Google) |
| Lifestyle | ÙØ³ØªØ§Ù†ÙŠ |
| Food | Ø£Ø·ÙŠØ¨ Ø·Ø¨Ø®Ø© |
| Cars | Ø¹Ø±Ø¨ Ø¬ÙŠ ØªÙŠ, Ø³ÙŠØ§Ø±Ø©, ØªÙŠØ±Ø¨Ùˆ |
| Health | ÙˆÙŠØ¨ Ø·Ø¨, ØµØ­ØªÙƒ, ÙƒÙ„ ÙŠÙˆÙ… Ù…Ø¹Ù„ÙˆÙ…Ø© Ø·Ø¨ÙŠØ© |
| Science | Ù†Ø§Ø³Ø§ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ |

### Key Learnings
1. **Test before adding**: Always curl-test RSS URLs - many return 404/403/Cloudflare blocks
2. **Google News workaround**: Works for sites that block direct RSS
3. **Two tables**: `sources` (display) vs `rss_sources` (backend RSS fetching)
4. **Cron handles fetching**: Edge functions run every 30 minutes via cron

---

*Documented by Claude - 2026-01-15*

---

## Session Log: Image Quality & Video Extraction (2026-01-14)

### Problem Statement
User reported:
1. "Bad pictures - zoom is too much" - Images cropped excessively to fill screen
2. "Can we fetch videos from articles?" - Most news won't have YouTube in RSS

### Solutions Implemented

#### 1. Blurred Background + Contain Mode (Spotify-style)

**Problem**: `fit=cover` crops images to fill vertical phone screen, losing important content.

**Solution**: Layer structure with blurred background:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–‘â–‘â–‘â–‘ BLURRED FILL â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚  â† Blurred image (cover, fills edges)
â”‚ â–‘â–‘â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â–‘â–‘ â”‚
â”‚ â–‘â–‘â”‚   SHARP IMAGE       â”‚â–‘â–‘ â”‚  â† Contain mode (full image, no crop)
â”‚ â–‘â–‘â”‚   (full content)    â”‚â–‘â–‘ â”‚
â”‚ â–‘â–‘â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â–‘â–‘ â”‚
â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚
â”‚ â–“â–“â–“â–“â–“â–“ GRADIENT â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“ â”‚
â”‚   Headline + Content        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Files Modified**:
| File | Changes |
|------|---------|
| `lib/image.ts` | Added `getBlurredImageUrl()`, updated `getOptimizedImageUrl()` with fit mode |
| `components/feed/StoryCard.tsx` | New layered structure with blur background |

**Technical Details**:
- Blurred: `wsrv.nl/?url=...&blur=15&q=40&fit=cover` (server-side blur)
- Sharp: `wsrv.nl/?url=...&fit=contain&q=85` (full image, no crop)
- 25% dark overlay on blur for depth separation
- Zero new dependencies (all server-side via wsrv.nl)

#### 2. Video Extraction from Article HTML

**Problem**: RSS feeds rarely include video URLs. Videos embedded in article HTML are missed.

**Solution**: Added HTML-level video extraction to `fetch-rss` edge function.

**Detection Sources**:
| Source | What it finds |
|--------|---------------|
| `og:video` meta tag | Video URL in OpenGraph metadata |
| `twitter:player` meta tag | Video in Twitter cards |
| `<video>` tags | HTML5 video elements |
| `<iframe>` embeds | YouTube, Vimeo, Dailymotion |
| Article body | Embedded video links in content |

**Platforms Supported**:
- YouTube (embed, watch, youtu.be short links)
- Vimeo
- Dailymotion
- Direct MP4/WebM files

**Files Modified**:
| File | Changes |
|------|---------|
| `supabase/functions/fetch-rss/index.ts` | Added `extractVideoFromHtml()`, updated `WebpageData` interface |

**Priority Order**:
1. Webpage video (from HTML) - preferred (more reliable)
2. RSS video (from feed metadata) - fallback

### Key Functions Added

```typescript
// lib/image.ts
getBlurredImageUrl(url, blurAmount=15, quality=40)
getOptimizedImageUrl(url, width, height, fitMode='contain')

// fetch-rss/index.ts
extractVideoFromHtml(doc, baseUrl)
detectVideoType(url)
normalizeVideoUrl(url, type)
isVideoFile(url)
```

### Deployment
- `fetch-rss` edge function deployed successfully
- App running on Expo port 8082

---

*Documented by Claude - 2026-01-14*
